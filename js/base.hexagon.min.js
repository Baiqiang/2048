function HTMLActuator(){this.tileContainer=document.querySelector(".tile-container"),this.scoreContainer=document.querySelector(".score-container"),this.bestContainer=document.querySelector(".best-container"),this.messageContainer=document.querySelector(".game-message"),this.score=0}function Tile(a,b){this.x=a.x,this.y=a.y,this.value=b||2,this.previousPosition=null,this.mergedFrom=null}function LocalScoreManager(){this.key=(window.gameName||"")+"-bestScore";var a=this.localStorageSupported();this.storage=a?window.localStorage:window.fakeStorage}function Grid(a,b){this.deleteCenter=b,this.size=a,this.cells=[],this.build()}!function(){for(var a=0,b=["webkit","moz"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var d=(new Date).getTime(),e=Math.max(0,16-(d-a)),f=window.setTimeout(function(){b(d+e)},e);return a=d+e,f}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),HTMLActuator.prototype.actuate=function(a,b){var c=this;window.requestAnimationFrame(function(){c.clearContainer(c.tileContainer),a.cells.forEach(function(a){a.forEach(function(a){a&&c.addTile(a)})}),c.updateScore(b.score),c.updateBestScore(b.bestScore),b.terminated&&(b.over?c.message(!1):b.won&&c.message(!0))})},HTMLActuator.prototype.continue=function(a){"undefined"!=typeof ga&&ga("send","event",window.gameName||"game",a?"restart":"keep playing"),this.clearMessage()},HTMLActuator.prototype.clearContainer=function(a){for(;a.firstChild;)a.removeChild(a.firstChild)},HTMLActuator.prototype.addTile=function(a){var b=this,c=document.createElement("div"),d=document.createElement("div"),e=a.previousPosition||{x:a.x,y:a.y},f=this.positionClass(e),g=["tile","tile-"+a.value,f];a.value>2048&&g.push("tile-super"),this.applyClasses(c,g),d.classList.add("tile-inner"),d.textContent=a.value,a.previousPosition?window.requestAnimationFrame(function(){g[2]=b.positionClass({x:a.x,y:a.y}),b.applyClasses(c,g)}):a.mergedFrom?(g.push("tile-merged"),this.applyClasses(c,g),a.mergedFrom.forEach(function(a){b.addTile(a)})):(g.push("tile-new"),this.applyClasses(c,g)),c.appendChild(d),this.tileContainer.appendChild(c)},HTMLActuator.prototype.applyClasses=function(a,b){a.setAttribute("class",b.join(" "))},HTMLActuator.prototype.normalizePosition=function(a){var b=[[{r:2,theta:120},{r:2,theta:90},{r:2,theta:60}],[{r:2,theta:150},{r:1,theta:120},{r:1,theta:60},{r:2,theta:30}],[{r:2,theta:180},{r:1,theta:180},{r:0,theta:0},{r:1,theta:0},{r:2,theta:0}],[{r:2,theta:210},{r:1,theta:240},{r:1,theta:300},{r:2,theta:330}],[{r:2,theta:240},{r:2,theta:270},{r:2,theta:300}]];return b[a.y][a.x]},HTMLActuator.prototype.positionClass=function(a){return a=this.normalizePosition(a),"tile-position-"+a.r+"-"+a.theta},HTMLActuator.prototype.updateScore=function(a){this.clearContainer(this.scoreContainer);var b=a-this.score;if(this.score=a,this.scoreContainer.textContent=this.score,b>0){var c=document.createElement("div");c.classList.add("score-addition"),c.textContent="+"+b,this.scoreContainer.appendChild(c)}},HTMLActuator.prototype.updateBestScore=function(a){this.bestContainer.textContent=a},HTMLActuator.prototype.message=function(a){var b=a?"game-won":"game-over",c=a?"You win!":"Game over!";"undefined"!=typeof ga&&ga("send","event",window.gameName||"game","end",b,this.score),this.messageContainer.classList.add(b),this.messageContainer.getElementsByTagName("p")[0].textContent=c},HTMLActuator.prototype.clearMessage=function(){this.messageContainer.classList.remove("game-won"),this.messageContainer.classList.remove("game-over")},Tile.prototype.savePosition=function(){this.previousPosition={x:this.x,y:this.y}},Tile.prototype.updatePosition=function(a){this.x=a.x,this.y=a.y},window.fakeStorage={_data:{},setItem:function(a,b){return this._data[a]=String(b)},getItem:function(a){return this._data.hasOwnProperty(a)?this._data[a]:void 0},removeItem:function(a){return delete this._data[a]},clear:function(){return this._data={}}},LocalScoreManager.prototype.localStorageSupported=function(){var a="test",b=window.localStorage;try{return b.setItem(a,"1"),b.removeItem(a),!0}catch(c){return!1}},LocalScoreManager.prototype.get=function(){return this.storage.getItem(this.key)||0},LocalScoreManager.prototype.set=function(a){this.storage.setItem(this.key,a)},Grid.prototype.build=function(){for(var a=0;a<this.size;a++)for(var b=this.cells[a]=[],c=0;c<this.size;c++)b.push(null)},Grid.prototype.randomAvailableCell=function(){var a=this.availableCells();return a.length?a[Math.floor(Math.random()*a.length)]:void 0},Grid.prototype.availableCells=function(){var a=[],b=this;return this.eachCell(function(c,d,e){!e&&b.withinBounds({x:c,y:d})&&a.push({x:c,y:d})}),a},Grid.prototype.eachCell=function(a){for(var b=0;b<this.size;b++)for(var c=0;c<this.size;c++)a(b,c,this.cells[b][c])},Grid.prototype.cellsAvailable=function(){return!!this.availableCells().length},Grid.prototype.cellAvailable=function(a){return!this.cellOccupied(a)},Grid.prototype.cellOccupied=function(a){return!!this.cellContent(a)},Grid.prototype.cellContent=function(a){return this.withinBounds(a)?this.cells[a.x][a.y]:null},Grid.prototype.insertTile=function(a){this.cells[a.x][a.y]=a},Grid.prototype.removeTile=function(a){this.cells[a.x][a.y]=null},Grid.prototype.withinBounds=function(a){return a.x>=0&&a.x<this.size-Math.abs(a.y-2)&&a.y>=0&&a.y<this.size&&(!this.deleteCenter||2!=a.x||2!=a.y)};